name: CI

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

# Declare default permissions as read only.
permissions: read-all

jobs:

  build:
    runs-on: ubuntu-latest
    steps:
    
    - name: Check PR title. If it contains SKIP, skip this CI test
      run: |
        if [[ title="${{ github.event.pull_request.title }}" ]]; then
        echo "PR title starts with 'SKIP'"
        exit 0
        else
        echo "PR title did not start with 'SKIP'"
        exit 0
        fi    
    
    - uses: actions/checkout@93ea575cb5d8a053eaa0ac8fa3b40d7e05a33cc8

    - name: Set up Go
      uses: actions/setup-go@bfdd3570ce990073878bf10f6b2d79082de49492
      with:
        go-version: 1.17

    - name: Build
      run: CGO_ENABLED=0 go build -trimpath -a -tags netgo -ldflags '-w -extldflags' -o scorecard-webapp

    - name: Test
      run: CGO_ENABLED=0 go test -trimpath -a -tags netgo -ldflags '-w -extldflags' -o scorecard-webapp
